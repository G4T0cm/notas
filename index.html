<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Notas De los buscadores</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>Banco de Notas De los buscadores</h1>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="create">Crear Nota</div>
            <div class="tab" data-tab="consult">Consultar Nota</div>
            <div class="tab" data-tab="list">Lista de Notas</div>
        </div>

        <div class="content">
            <!-- Crear Nota -->
            <div id="create-tab" class="tab-content active">
                <h2>Crear Nueva Nota</h2>
                <div class="form-group">
                    <label for="note-content">Contenido:</label>
                    <textarea id="note-content" placeholder="Escribe tu apunte aquí..."></textarea>
                </div>
                <button id="save-note" class="button-full">Guardar Nota</button>
                <div id="save-result" class="result">
                    <p>Tu nota ha sido guardada correctamente. Código:</p>
                    <div class="code" id="generated-code"></div>
                </div>
            </div>

            <!-- Consultar Nota -->
            <div id="consult-tab" class="tab-content">
                <h2>Consultar Nota</h2>
                <div class="form-group">
                    <label for="note-code">Código:</label>
                    <input type="text" id="note-code" placeholder="Ejemplo: A1B2C3">
                </div>
                <button id="consult-note" class="button-full">Consultar</button>
                <div id="consult-result" class="result">
                    <p>Contenido:</p>
                    <div class="note-display" id="note-display"></div>
                </div>
            </div>

            <!-- Lista de Notas -->
            <div id="list-tab" class="tab-content">
                <h2>Lista de Notas Guardadas</h2>
                <button id="load-notes" class="button-full">Mostrar Todos los Códigos</button>
                <div id="notes-list" class="note-display"></div>
            </div>
        </div>

        <footer>Banco de Notas - por Gato</footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

    <script>
        /* 🔧 Configura tu Firebase aquí */
        const firebaseConfig = {
            apiKey: "AIzaSyAe26JxjylsYuajP6iXQonmUfS29FWhCm0",
            authDomain: "gatonotas-181b2.firebaseapp.com",
            projectId: "gatonotas-181b2",
            storageBucket: "gatonotas-181b2.appspot.com",
            messagingSenderId: "177659023483",
            appId: "1:177659023483:web:566c7125e67e450545d2de",
            measurementId: "G-JCEEDFTNKF"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1428468208725397667/GVAb3u0dqWNBKRMW33QZxcynxtmCO4JBmXJNmWr2nGeAxfbC8qh_oXc2jw02JWSpVfYD";

        // DOM elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const noteContent = document.getElementById('note-content');
        const noteCode = document.getElementById('note-code');
        const saveBtn = document.getElementById('save-note');
        const consultBtn = document.getElementById('consult-note');
        const saveResult = document.getElementById('save-result');
        const generatedCode = document.getElementById('generated-code');
        const consultResult = document.getElementById('consult-result');
        const noteDisplay = document.getElementById('note-display');
        const loadNotesBtn = document.getElementById('load-notes');
        const notesList = document.getElementById('notes-list');

        // Cambiar pestañas
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                saveResult.style.display = 'none';
                consultResult.style.display = 'none';
            });
        });

        // Generar código aleatorio
        function generateCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
            return code;
        }

        // Guardar nota en Firebase
        saveBtn.addEventListener('click', async () => {
            const content = noteContent.value.trim();
            if (!content) return alert('Escribe algo antes de guardar.');

            const code = generateCode();
            try {
                await db.collection('notes').doc(code).set({
                    content,
                    createdAt: new Date().toISOString()
                });

                generatedCode.textContent = code;
                saveResult.className = 'result success';
                saveResult.style.display = 'block';
                noteContent.value = '';

                // Enviar a Discord
                fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: "Banco de Notas",
                        embeds: [{
                            title: "📝 Nueva nota guardada",
                            description: `**Código:** ${code}\n**Contenido:**\n${content}`,
                            color: 5814783
                        }]
                    })
                });
            } catch (error) {
                console.error('Error guardando nota:', error);
                alert('Error al guardar la nota.');
            }
        });

        // Consultar nota
        consultBtn.addEventListener('click', async () => {
            const code = noteCode.value.trim().toUpperCase();
            if (!code) return alert('Introduce un código.');

            try {
                const doc = await db.collection('notes').doc(code).get();
                if (!doc.exists) {
                    consultResult.className = 'result error';
                    consultResult.style.display = 'block';
                    noteDisplay.textContent = 'No se encontró ninguna nota con ese código.';
                    return;
                }

                consultResult.className = 'result success';
                consultResult.style.display = 'block';
                noteDisplay.textContent = doc.data().content;
                noteCode.value = '';
            } catch (error) {
                console.error('Error consultando nota:', error);
                alert('Error al consultar la nota.');
            }
        });

        // Listar todas las notas con vista previa y borrar
        loadNotesBtn.addEventListener('click', async () => {
            notesList.innerHTML = '<p class="loading">Cargando...</p>';

            try {
                const snapshot = await db.collection('notes').get();
                if (snapshot.empty) {
                    notesList.innerHTML = '<p>No hay notas guardadas.</p>';
                    return;
                }

                notesList.innerHTML = '';
                snapshot.forEach(doc => {
                    const noteDiv = document.createElement('div');
                    noteDiv.style.display = 'flex';
                    noteDiv.style.flexDirection = 'column';
                    noteDiv.style.padding = '10px';
                    noteDiv.style.marginBottom = '10px';
                    noteDiv.style.border = '1px solid #ddd';
                    noteDiv.style.borderRadius = '5px';
                    noteDiv.style.backgroundColor = '#fefefe';

                    noteDiv.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span><strong>${doc.id}</strong></span>
                            <button style="background-color:#e74c3c;padding:5px 10px;border:none;border-radius:5px;color:white;cursor:pointer;">Borrar</button>
                        </div>
                        <div style="margin-top:5px; color:#555; white-space: pre-wrap;">${doc.data().content}</div>
                    `;

                    const deleteBtn = noteDiv.querySelector('button');
                    deleteBtn.addEventListener('click', async () => {
                        if (confirm(`¿Seguro que quieres borrar la nota ${doc.id}?`)) {
                            try {
                                await db.collection('notes').doc(doc.id).delete();
                                noteDiv.remove();
                            } catch (error) {
                                alert('Error al borrar la nota.');
                                console.error(error);
                            }
                        }
                    });

                    notesList.appendChild(noteDiv);
                });
            } catch (error) {
                console.error('Error cargando notas:', error);
                notesList.innerHTML = '<p>Error al cargar las notas.</p>';
            }
        });
    </script>
</body>
</html>
